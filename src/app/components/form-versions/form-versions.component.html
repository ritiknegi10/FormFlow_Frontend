<div *ngIf="isChangeDeadlinePopUp" (click)="isChangeDeadlinePopUp = false"
    class="fixed inset-0 bg-black/60 z-[900] transition-opacity duration-300" 
    [ngClass]="{
        'opacity-100 pointer-events-auto': isChangeDeadlinePopUp,
        'opacity-0 pointer-events-none': !isChangeDeadlinePopUp
    }">
</div>

<div *ngIf="isChangeDeadlinePopUp" class="fixed top-1/3 -translate-y-1/2 left-1/2 -translate-x-1/2 px-6 py-4 w-72 rounded-xl bg-white shadow-lg z-[1000]">
    <div class="flex items-center justify-between">
        
        <label class="flex items-center text-lg font-semibold tracking-wide text-indigo-700">
            <svg class="w-6 h-6 mr-1 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>Change deadline</span>
          </label>
        <button class="text-gray-500 p-2 rounded-full hover:bg-gray-100 active:bg-gray-300" (click)="isChangeDeadlinePopUp = false">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        
    </div>

    <div class="flex flex-col gap-3">
        <label class="flex flex-col gap-2">
            <span>Old deadline</span>
            <input type="datetime-local" [min]="" [value]="" [disabled]="true"
            class="select-none min-w-64 sm:w-2/3 lg:w-1/3 px-3 py-2 text-gray-700 border-2 focus:outline-none focus:border-none border-gray-200 rounded-xl "/>
        </label>

        <label class="flex flex-col gap-2">
            <span>New deadline</span>
            
            <input type="datetime-local" [min]="" [(ngModel)]="deadline"
            class="min-w-64 sm:w-2/3 lg:w-1/3 px-3 py-2 text-gray-700 border-2 focus:outline-none focus:border-none border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-600 transition-all"/>
        </label>
        <!-- validation text -->
        <div *ngIf="isDeadlineNull" 
            class="flex items-center gap-1 text-red-500 text-sm mt-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            Please enter a complete deadline (date and time)
        </div>
        <div *ngIf="isDeadlinePast" 
            class="flex items-center gap-1 text-red-500 text-sm mt-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            Deadline must be in the future
      </div>
    </div>
    <div class="flex gap-3 items-center justify-end mt-5">
        <button (click)="isChangeDeadlinePopUp = false" 
            class="px-3 py-2 text-gray-600 font-medium rounded-md hover:bg-gray-100">Cancel</button>
        <button (click)="updateDeadline()"
            class="px-3 py-2 bg-gradient-to-r from-purple-700 to-indigo-600 text-white font-medium 
        rounded-md hover:shadow-lg hover:from-indigo-700 hover:to-purple-800 transition-all duration:300 shadow-sm">Change</button>
    </div>
</div>

<div class="min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-blue-100 py-12 px-6 sm:px-12 lg:px-20">

    
  
    <div class="max-w-4xl mx-auto">
        
        <div class="text-center mb-12">
        <div class="mb-6 animate-pulse">
            <svg class="w-16 h-16 mx-auto text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            
        </div>
        <h2 class="text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
            Version History
        </h2>
        <p class="text-lg text-gray-600 mt-3">Explore previous versions of your form</p>
        </div>

        <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-gray-200 p-8">
        
        <div>
            <button (click)="changeDeadlinePopUp()"
                class="px-3 py-2 bg-indigo-100 text-indigo-800 font-medium hover:bg-indigo-200">Change deadline</button>
        </div>
        <div class="flex justify-end items-center mb-4">
            <label for="versionDropdown" class="font-semibold text-gray-900 tracking-wide">Select Version:</label>
            <select id="versionDropdown" [(ngModel)]="selectedVersion" (change)="onVersionChange()"
            class="w-48 px-2 py-3 ml-3 border-2 border-gray-200 rounded-lg focus:ring-4 
                focus:ring-indigo-100 focus:border-indigo-500 transition-all cursor-pointer">
                <option *ngFor="let version of versions" [value]="version">Version {{ version }}</option>
            </select>
        </div>
        
        <form *ngIf="form" [formGroup]="form" (submit)="$event.preventDefault()">
            <div class="mb-12 space-y-6">
                <div>
                    <label class=" text-lg font-semibold text-gray-900 mb-3 flex items-center">
                        <svg class="w-6 h-6 mr-2 text-indigo-600" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        Form Details
                    </label>
                    <input type="text" formControlName="title" placeholder="Form Title"
                        class="bg-gray-100 w-full px-5 py-4 text-lg border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all">

                </div>

                <div>
                    <textarea formControlName="description" rows="3" placeholder="Form Description"
                        class= "w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all">
                    </textarea>
                </div>
            </div>

                
            <div formArrayName="sections" class="space-y-6">
                <div *ngFor="let section of sections.controls; let sIdx=index" [formGroupName]="sIdx">
                    <div class="bg-white/90 backdrop-blur-sm border-2 border-gray-200 rounded-xl shadow-lg p-6 space-y-4">
                        <div *ngIf="sections.controls.length > 1"
                            class="text-lg font-semibold border-none outline-none text-indigo-700">
                            Section {{ sIdx + 1 }} of {{ sections.length }}
                        </div>

                        <!-- SECTION TITLE & DESCRIPTION -->
                        <div *ngIf="sIdx != 0" class="border-2 px-3 py-5 border-gray-200 rounded-xl">
                            <input type="text" 
                                formControlName="sectionTitle" placeholder="Section Title (optional)"
                                class="font-semibold w-full px-2 py-1 mb-4 border-b-2 focus:outline-none text-indigo-700">
                            
                            <input type="text" formControlName="sectionDescription" placeholder="Section Description (optional)"
                                class="w-full px-2 py-1 border-b-2 focus:outline-none">
                        </div>

                        <!-- SECTION QUESTIONS -->
                        <div formArrayName="questions" class="space-y-6">
                            <div *ngFor="let question of getQuestionsControl(section).controls; let qIdx = index" [formGroupName]="qIdx"
                                class="bg-gray-50 border-2 border-gray-200 rounded-xl shadow-md hover:shadow-lg hover:border-gray-300 group relative">
                                <div class="flex items-center justify-between mb-3 px-6 pt-3">
                                    <!-- QUESTION HEADER  -->
                                    <div class="flex items-center gap-2 text-gray-500 text-sm">
                                        <span class="font-medium">Question {{ qIdx + 1 }}</span>
                                        <div class="w-px h-4 bg-gray-300"></div>
                                        <span class="capitalize">{{ question.get('type')?.value }}</span>
                                    </div>
                                </div>
                                

                                <!-- QUESTION -->
                                <div class="space-y-3 p-6">
                                    <div class="flex gap-2 items-center sm:flex-row flex-col">
                                        <input type="text" formControlName="questionText" placeholder="Enter your question"
                                            class="sm:flex-1 w-full px-4 py-2.5 border-2 outline-none border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-200 transition-all">
                                        <select formControlName="type"
                                            class="sm:w-56 w-full px-3 py-3 border-2 outline-none border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-200 transition-all">
                                            <option value="shortText">Short Text</option>
                                            <option value="paragraph">☰ Paragraph</option>
                                            <option value="multipleChoice">◉ Multiple Choice</option>
                                            <option value="checkboxes">☑ Checkboxes</option>
                                            <option value="dropdown">▼ Dropdown</option>
                                            <option value="rating">☆ Rating</option>
                                            <option value="date">📅 Date</option>
                                            <option value="time">⏰ Time</option>
                                            <option value="linearscale">➖ Linear Scale</option>
                                            <option value="multipleChoiceGrid">▦ Multiple Choice Grid</option>
                                            <option value="checkboxGrid">☑▦ Checkbox Grid</option>
                                            <option value="file">📁 File Upload</option>
                                        </select>
                                    </div>

                                    <!-- QUESTION DESCRIPTION -->
                                    <div *ngIf="question.get('questionDescription')?.value !== '' ">
                                        <input type="text" formControlName="questionDescription" placeholder="Description"
                                            class="mb-3 border-b-2 w-full px-3 py-1 h-12 border-gray-200 outline-none focus:bg-gray-100 focus:border-indigo-400"/>
                                    </div>

                                    <!-- GRIDS -->
                                    <div *ngIf="question.get('type')?.value === 'checkboxGrid' ||
                                            question.get('type')?.value === 'multipleChoiceGrid'" 
                                        class="space-y-4">
                                        <!-- Rows -->
                                        <div>
                                            <div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
                                                <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                                                </svg>
                                                Rows
                                            </div>

                                            <div formArrayName="rows" class="space-y-2 ml-4">
                                                <div *ngFor="let row of question.get('rows')?.value; let rowIdx = index" class="flex items-center gap-2">
                                                    <input type="text" [formControlName]="rowIdx" placeholder="Row name"
                                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-200 focus:border-green-500" />                                                    
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Columns -->
                                        <div>
                                            <div class="flex items-center gap-2 text-sm text-gray-600 mt-4 mb-2">
                                                <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4v16M12 4v16M18 4v16" />
                                                </svg>
                                                Columns
                                            </div>

                                            <div formArrayName="columns" class="space-y-2 ml-4">
                                                <div *ngFor="let col of question.get('columns')?.value; let colIdx = index" class="flex items-center gap-2">
                                                    <input type="text" [formControlName]="colIdx" placeholder="Column name"
                                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-200 focus:border-blue-500" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Linear Scale -->
                                    <div *ngIf="question.get('type')?.value === 'linearscale'" class="flex gap-4 items-center mt-4">
                                        <div>
                                            <label class="block mb-1 font-medium">Start Value</label>
                                            <select formControlName="startValue"
                                                class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600">
                                                <option *ngFor="let num of [0, 1]" [value]="num">{{ num }}</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block mb-1 font-medium">End Value</label>
                                            <select formControlName="endValue"
                                                class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600">
                                                <option *ngFor="let num of [5, 6, 7, 8, 9, 10]" [value]="num">{{ num }}</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Rating -->
                                    <div *ngIf="question.get('type')?.value === 'rating'"
                                        class="flex gap-5 pt-4">
                                        <select formControlName="rating"
                                            class="px-3 py-2 w-20 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-600">
                                            <option *ngFor="let num of ratingOptions" [value]="num">{{ num }}</option>
                                        </select>
                                        <div class="flex gap-3">
                                            <div *ngFor="let num of getStarsArray(question.get('rating')?.value)" 
                                                class="flex flex-col justify-center items-center">
                                                <span class="text-sm text-gray-600">{{ num }}</span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" class="text-gray-400" viewBox="0 0 24 24" 
                                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <polygon points="12 2 15 8 22 9 17 14 18 21 12 17 6 21 7 14 2 9 9 8" />
                                            </svg>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- QUESTION OPTIONS -->
                                    <div *ngIf="question.get('type')?.value === 'multipleChoice' 
                                        || question.get('type')?.value === 'checkboxes' 
                                        || question.get('type')?.value === 'dropdown'" 
                                        class="space-y-3">

                                        <div class="relative text-sm text-gray-600">
                                            <div class="inline-flex flex-col w-auto items-center">
                                                <div class="peer flex items-center">
                                                    <svg class="w-5 h-5 transition-transform duration-200 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" >
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                                    </svg>
                                                    <span class="font-medium">Options</span>
                                                </div> 
                                            </div>
                                        </div>

                                        <!--OPTIONS FOR LOOP-->
                                        <div formArrayName="options" class="space-y-2 ml-4">
                                            <div *ngFor="let option of getOptions(question).controls; let opIdx = index" [formGroupName]="opIdx"
                                                class="flex items-center gap-2">

                                                <input type="text" 
                                                    formControlName="label" placeholder="Option text" 
                                                    class="flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2
                                                    focus:ring-indigo-100 focus:border-indigo-500 transition-all"
                                                />

                                                <div *ngIf="question.get('sectionBasedonAnswer')?.value">
                                                    <select formControlName="goToSection"
                                                        class="px-3 py-2 outline-none focus:bg-gray-200">
                                                        <option *ngFor="let section of sections.controls; let idx = index" [ngValue]="idx">
                                                            Go to {{ 'Section' + (idx+1) }} ({{ section.get('sectionTitle')?.value }})
                                                        </option>
                                                        <option [ngValue]="-1">Submit Form</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div> <!--OPTIONS FOR LOOP-->
                                    </div> <!--QUESTION OPTIONS END-->

                                    <!-- QUESTION OTHER ACTIONS -->
                                    <div class="flex items-center justify-end mt-6 mx-4 pt-4 pb-6 border-t px-6 border-gray-200">
                                        <!-- REQUIRED TOGGLE -->
                                        <label class="flex items-center gap-2 px-3 text-gray-600">
                                            <input type="checkbox" formControlName="required" class="sr-only peer">
                                            <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-600
                                                transition-colors duration-200 right-0.5">
                            
                                            </div>
                                            <div class="relative right-12 w-4 h-4 bg-white rounded-full shadow-sm
                                                transition-transform duration-200 peer-checked:translate-x-5"></div>
                                            <span class="text-sm -ml-6 font-medium">Required</span>
                                        </label>
                                    </div>
                                </div>
                            </div> <!--QUESTION END-->
                        </div> <!-- SECTION QUESTIONS DIV END-->
                    </div> <!-- SECTION GROUP END -->

                    <div *ngIf="sections.length > 1"
                        class="px-2 py-4">
                        After Section {{ sIdx + 1}}:
                        <select formControlName="nextSection"
                            class="p-2 ml-2 outline-none bg-transparent focus:bg-gray-200">
                            <option [ngValue]="sIdx + 1">Continue to next section</option>
                            <option *ngFor="let section of sections.controls; let idx = index" [ngValue]="idx">
                                Go to {{ 'Section' + (idx+1) }} ({{ section.get('sectionTitle')?.value }})
                            </option>
                            <option [ngValue]="-1">Submit Form</option>
                        </select>
                    </div>
                </div> <!--SECTIONS FOR LOOP-->
            </div> <!--SECTIONS DIV END-->
        </form> <!--FORM END-->

        <div class="flex justify-center mt-4 relative">
            <button (click)="cloneVersion()" type="button"
                class="px-6 py-2.5 bg-gradient-to-r peer from-indigo-600 to-purple-600 text-white font-semibold rounded-lg hover:shadow-lg transition-all transform hover:-translate-y-0.5 shadow-sm">
                Clone
            </button>
            <div
                class="absolute top-12 invisible peer-hover:visible text-nowrap transition-all duration-100 text-white text-xs px-2 py-1 rounded-lg bg-gray-700 bg-opacity-80">
                Clone version to edit
            </div>
        </div>
        </div>
    </div>
</div>



