<div class="container mx-auto p-4">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="flex justify-center items-center py-8">
    <div class="spinner">Loading...</div>
  </div>

  <!-- Error Message -->
  <div *ngIf="adminError && !isLoading" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    {{ adminError }}
  </div>

  <!-- Stats Section -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
    <!-- User Stats -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">User Stats</h2>
      <div *ngIf="userStats; else loading">
        <p>Total Users: {{ userStats?.totalUsers }}</p>
        <p>Active Users (Last 30 Days): {{ userStats?.activeUsers }}</p>
      </div>
      <ng-template #loading>Loading...</ng-template>
    </div>

    <!-- Form Stats -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Form Stats</h2>
      <div *ngIf="formStats; else loading">
        <p>Total Forms: {{ formStats?.totalForms }}</p>
        <p>Active Forms: {{ formStats?.activeForms }}</p>
        <p>Assigned Forms: {{ formStats?.assignedForms }}</p>
        <p>Public Forms: {{ formStats?.publicForms }}</p>
      </div>
      <ng-template #loading>Loading...</ng-template>
    </div>

    <!-- Response Stats -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Response Stats</h2>
      <div *ngIf="responseStats; else loading">
        <p>Total Responses: {{ responseStats?.totalResponses }}</p>
      </div>
      <ng-template #loading>Loading...</ng-template>
    </div>
  </div>

  <!-- Insights Section -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
    <!-- Average Responses -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Average Responses per Form</h2>
      <p>{{ avgResponsesPerForm | number:'1.2-2' }}</p>
    </div>

    <!-- File Count -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Total Files in S3</h2>
      <p>{{ fileCount }}</p>
    </div>
  </div>

  <!-- Lists Section -->
  <div class="space-y-8">
    <!-- Top Creators -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Top Form Creators</h2>
      <table class="min-w-full divide-y divide-gray-200">
        <thead>
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let user of topCreators">
            <td class="px-6 py-4 whitespace-nowrap">{{ user.username }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ user.email }}</td>
          </tr>
          <tr *ngIf="topCreators.length === 0">
            <td colspan="2" class="px-6 py-4 text-center text-gray-500">No data available</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Most Assigned Users -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Users with Most Assigned Forms</h2>
      <table class="min-w-full divide-y divide-gray-200">
        <thead>
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let user of mostAssignedUsers">
            <td class="px-6 py-4 whitespace-nowrap">{{ user.username }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ user.email }}</td>
          </tr>
          <tr *ngIf="mostAssignedUsers.length === 0">
            <td colspan="2" class="px-6 py-4 text-center text-gray-500">No data available</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Viewers -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Users with Viewer Access</h2>
      <table class="min-w-full divide-y divide-gray-200">
        <thead>
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let user of viewers">
            <td class="px-6 py-4 whitespace-nowrap">{{ user.username }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ user.email }}</td>
          </tr>
          <tr *ngIf="viewers.length === 0">
            <td colspan="2" class="px-6 py-4 text-center text-gray-500">No data available</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Top Responded Forms -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">Most Responded Forms</h2>
      <table class="min-w-full divide-y divide-gray-200">
        <thead>
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created At</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let form of topRespondedForms">
            <td class="px-6 py-4 whitespace-nowrap">{{ form.title }}</td>
            <td class="px-6 py-4">{{ form.description }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ form.createdAt | date:'short' }}</td>
          </tr>
          <tr *ngIf="topRespondedForms.length === 0">
            <td colspan="3" class="px-6 py-4 text-center text-gray-500">No data available</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- New Forms -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-xl font-semibold mb-4">New Forms This Week</h2>
      <table class="min-w-full divide-y divide-gray-200">
        <thead>
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created At</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <tr *ngFor="let form of newForms">
            <td class="px-6 py-4 whitespace-nowrap">{{ form.title }}</td>
            <td class="px-6 py-4">{{ form.description }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ form.createdAt | date:'short' }}</td>
          </tr>
          <tr *ngIf="newForms.length === 0">
            <td colspan="3" class="px-6 py-4 text-center text-gray-500">No data available</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>